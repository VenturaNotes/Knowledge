---
Source:
  - https://www.youtube.com/watch?v=8dz0riI13j8
Reviewed: false
---
- ![[Screenshot 2024-10-02 at 1.10.34 AM.png]]
	- Intro
		- hello everyone your boy is back doing another morning recording so his roommate doesn't find out about his channel. Additionally i'm feeling a lot of self-pity and shame today because i'm extremely hungover after a night of heavy drinking and then ultimately killing my diet by getting 7/11 taquitos. With that being said this axe is a perfect time for me to make a very quick video about [[gossip protocol]] so we can talk about [[Cassandra]] tomorrow. Let's get into this because i want to be done.
	- [[Gossip Protocol]] Background
		- Description
			- In many systems, we want to be able to pass information around from node to node in order to achieve a broadcasting of information. This can be useful in many types of clusters, but the reason I'm covering it here is because Cassandra uses a gossip protocol in order to have nodes communicate with one another which nodes they believe are active and which have failed. Very useful when trying to communicate across many nodes, without using some sort of centralized coordination service which requires extra infrastructure.
		- alrighty gossip protocols, what is it. Anytime that we have a bunch of nodes in any different type of cluster, a lot of times we want to be able to pass information directly from node to node. This is basically in contrast to something like a coordination or a membership service which is one centralized and perhaps even consensus service if you want it to be fault tolerant which keeps track of information about nodes in a cluster. Like i said, gossip protocols are when nodes actually pass information directly amongst themselves and it's kind of modeled after the spread of an infectious disease which means that each node is going to pass some information to another node which passes some information to a few other nodes and you know the goal is to get it to spread quickly over time. The reason why this is useful at least in my case is that like i said, tomorrow i want to make a video about [[Cassandra|Apache Cassandra]] and Cassandra uses gossip protocol as kind of its main method of determining nodes in the cluster and whether or not they've failed. So i think i'm going to quickly explain gossip protocol and then we can do a deeper dive into Cassandra tomorrow. 
	- Gossip Protocol Visualized
		- Description
			- Pick a few (let's say 2) nodes randomly, and broadcast the message to them!
				- After a few rounds, there is a high probability each node will receive a message!
		- okay so let's visualize it. It's pretty simple for the most part. All we're going to do is pick a few nodes randomly, broadcast any message that the original node has to them. Keep in mind the only time you're going to be doing new broadcasts is on the first time you receive the message. So we have this black node here. This is the first one to have the message you know say it gets some heartbeat from another node and it's like okay i want to tell all the other nodes that i just received this heartbeat. So we're going to pick two nodes randomly and broadcast it to them. 
		- Okay, so as you can see now we have two other infected nodes both of which are going to also tell two nodes. Now you can see the top node here is going to tell the original node again just randomly. So the original node is not going to rebroadcast, but it is the case that the top node is still going to reach one other new node. 
		- So now we've got three new nodes infected in the next round which you're going to go ahead and randomly keep trying to tell other nodes.
- ![[Screenshot 2024-10-02 at 1.19.26 AM.png]]
	- Gossip Protocol Visualized (continued)
		- Eventually boom okay everyone knows about the message which is great as you can see in large clusters after a few rounds of running this gossip protocol, we can generally get our messages all around.
	- Gossip Protocol in Cassandra
		- Description
			- Used to pass details about node membership/failure in a cluster:
				- Each node is gossiping with other nodes regarding its own local load
				- Each node is gossiping with other nodes about heartbeats it receives from all other nodes, which contain a timestamp
				- Other nodes, upon receiving gossip, use the timestamps to keep only the most recent messages and then pass them on
				- All nodes us the most recent heartbeat timestamp to determine if other nodes in the cluster are down
		- so why is this useful in Cassandra? Well basically it's used to pass details about node membership and failure in a cluster. So what are we actually passing in the gossip protocol? Each node is basically gossiping with the other nodes regarding its own load so it's saying here's my local state, this is how i'm doing in terms of you know like how many writes i'm taking in and um you know if i'm kind of like looking like i'm going to crash soon. Each node is also receiving heartbeats from other nodes um incrementally via this gossip protocol and it's going and saying okay i've received a heartbeat, here's the timestamp of the heartbeat that i received and um keep in mind though that obviously the issue with these timestamps is that server timestamps are not always coordinated so that can be problematic there in terms of ordering the messages but that's just something to keep in mind. And then other nodes upon receiving the gossip will use those time stamps to basically say, okay you know i see that node 1 received a heartbeat at 12 o'clock but node 2 received a heartbeat from this other node at 1 o'clock so i'll keep the 1 o'clock timestamp and that's the most recent anyone's ever heard from that node and so it's going to hold on to that timestamp and basically use those timestamps for each node locally to try and guess if that node is still up or not. So if all of the nodes are assuming that a node is down because no one's received a heartbeat from it in an hour, then eventually they'll stop sending writes to it. 
	- Gossip Protocol Conclusion
		- Description
			- Good for quickly broadcasting messages to many nodes with relatively low overhead/coordination! Useful in large clusters to perform things like failure detection by gossiping all of the heartbeats that they have received. Note that gossip protocols do not ensure any ordering of messages, they are just throwing as many around as possible - for ordering you need some other way of doing so (e.g. timestamps in Cassandra, or maybe a vector clock)
		- So yeah i mean, that's basically how gossip protocol gets used in Cassandra but generally speaking gossip protocol is just a good low overhead system for communicating messages to a bunch of nodes in a cluster and it's got relatively low overhead and coordination. We're not using any membership services. It's really good for doing failure detection like i said but obviously it's not perfect. Not every node is reaching consensus at the same exact time. It's going to take a bit for those messages to get propagated and then furthermore, the messages are not being delivered in order. If a bunch of nodes are gossiping their own messages, then those can come in out of order and you have to use something like time stamps or vector clocks to perform the ordering of the messages and determine which to keep and which to throw away. Okay that was a quick one, i'm actually dying right now so yeah have a good one and i'll speak to you guys later
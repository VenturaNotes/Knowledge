---
Source:
  - https://www.youtube.com/watch?v=w2USXdq58Yc
---
- ![[Screenshot 2024-11-11 at 9.30.02 PM.png]]
	- Introduction
		- All right, uh, welcome back everybody. Uh today's topic is going to be about [[content delivery networks]] also known as CDNs for short. Um these should be pretty important to all of you because considering that all of us software Engineers watch probably 3 to 6 hours a day, they've probably completely revolutionized the speed of that. So you know you've got something to thank CDNs for. But anyways, let's get into this video. It should be a pretty quick one and then we can keep moving on to more cool topics.
	- Content Delivery Networks (Background)
		- Description
			- In most large scale systems, there is a need to serve to a user a variety of static content - this includes HTML files, images, videos, or any other file type where the data is not expected to change frequently
			- However, these files are typically large, and as a result serving them from our application servers can potentially be very slow, especially when the end user accessing them is far away. Additionally, there is no reason for a server to have to recompute these files every time, since they are static and should not be changing
			- To solve these problems, companies use Content Delivery Networks (CDNs).
		- Okay, so content delivery Networks or CDN for short. So basically the point is in most large scale websites or systems, they have a ton of static content that they want to be serving to their users. Static content includes any file that basically isn't going to be frequently changing or you know appended to or truncated. So that's things like HTML files for certain pages of a website, images and video content that users tend to upload and basically just any other file that generally is written once and that doesn't really have to be modified. However, the thing with these files is you know obviously compared to just like a row of data in a database, they're pretty large and as a result it's going to take a really long time to serve them from our application server and additionally it takes a lot of load on our application server to be able to actually go fetch those from probably some sort of underlying data store and then go ahead and serve them to the end user. So as a result, basically what we want to use is something called a Content delivery Network or a CDN and I'll kind of explain how that makes this process much better in a little bit. 
	- Storing Static Content
		- Description
			- Where do we generally store static content? An object store like S3, Azure Blob storage, or Google Cloud Storage.
				- Far more scalable than running a cluster dedicated to running a distributed file system such as HDFS
					- Unlike HDFS, files are stored using keys and value, as opposed to in a directory hierarchy
					- You only pay for the space that you use, as opposed to all the hardware in the cluster
					- Can scale storage independently from compute by nature of cloud services
					- Object accesses should be faster as flat structure allows avoiding use of a NameNode, no locks on data since writes are immutable (new writes to same key increases version number)
				- However, there are also down sides to object stores
					- No support for multi-object transactions
					- If you want to run batch jobs/streaming, you need to first transfer data over the network to an HDFS cluster, do not receive data locality benefits
		- But first, before we do that, let's just talk about storing static content in general. I didn't really want to devote a full video to this because truthfully I'm not sure that it even requires a full video but basically speaking whenever you're dealing with storing static content in something like a systems designed interview problem, you should always just go ahead and say you're going to use an object store. Now most channels will basically just say use an object store but in this video I'm going to do my best to explain it. Uh generally speaking, object stores are something like AWS S3, Azure blob storage or uh Google Cloud Storage. So the reason that we would use something like an object store as opposed to you know something like a distributed file system like HDFS is mainly that it is going to be much cheaper and much more scalable and potentially even faster. So let's explain why that might happen. Well first of all, uh unlike in HDFS, uh object stores have a flat structure which means that you're just using keys and values for those files as opposed to putting them in a whole directory hierarchy. Um, what this means is that basically you can go ahead and use something like a consistent hashing method to go ahead and find those files or write those files so you don't need something like a centralized name node like Hadoop tends to use. This is going to obviously speed up reads and writes a little bit in addition to the fact that there are weaker guarantees on these object stores such that you can't do things like Atomic renames of files and as a result of that, it means that there aren't going to be any locks on files. You don't really have any um you know concurrency guarantees in the sense that if a new version of a file is written, it's just going to have a higher version number. There's no potential for you to just like read a file and it's only half updated. So you don't really have to worry about atomicity but there's also no locking which does make things a little bit faster. Additionally, the bigger reason that these object stores are more scalable is the fact that you only pay for the storage that you use. Um since we're using a cloud environment here, you can basically just be like "give me more hard drives" whereas if you're running your own Hadoop cluster, you probably have to run it on more physical CPUs in addition to hard drives as well and what that basically means is that your compute and your storage are scaling linearly with one another. Um there are a couple of downsides to these object Stores. Um, so the first one is basically going to be that you can't do multi-object transactions if you want to do something like that. You probably need to use something like two-phase commit or perhaps even a coordination service. I'm actually not even sure the two-phase commit would be built in so probably instead what you might have to do is do one of the writes, check if it succeeded, then do the second but obviously that runs into a lot of issues too, so maybe something like a coordination service. Honestly I'm not even sure, but if you do want to run something like batch jobs and streaming, um object stores might not be the best thing for you. The reason for that being they are solely meant to actually just be holding immutable files so if you want to actually go ahead and run some analytics on them, generally speaking you have to go ahead and copy those files over to a Hadoop cluster (some sort of cluster of nodes) that can actually support batch or streaming jobs and as a result, you lose that data locality that is so useful in Hadoop because you first have to copy over all the files over the network before you can actually start performing that compute logic. As a result, that's going to take a ton of time so it is less efficient for doing that but generally speaking these object stores are going to be cheaper and more scalable, so that's the reason that people tend to use them for static content. 
	- Object Stores Aren't Good Enough
		- Description
			- Even if you have your content in S3, these are generally large files and having to make network calls on each request is very inefficient. If the user is located far away from your application servers, the problem becomes even more of an issue.
			- Enter CDNs!
		- Generally speaking though even though like I said they're decently fast, object stores probably aren't good enough for you. If you're a huge website like Google or you know YouTube or TikTok, you're going to have users all over the globe and you don't really want to just be hammering your servers with all these repeated requests for certain static content. Additionally if you have users all over the globe and your servers are say located all over in California, a request for a big file from I don't know say India is going to take forever. So this is kind of where CDNs come in
	- Content Delivery Networks
		- Description
			- A special type of geographically distributed cache that you should use to store static content from your servers
				- Partition the data such that data for specific geographic regions goes to the particular CDN that you want
				- CDNs can be either push or pull based
					- Push: Servers periodically send data to be stored in the CDN, and it serves all of the requests for that static content
						- Good for news sites, HTML home pages
					- Pull: Clients ask CDNs for content, and if they do not store it, get it from the server and then store it
						- Good for social media sites like YouTube, TikTok, Instagram
		- CDNs are basically just a special type of cache that is geographically distributed. Uh generally speaking, your normal cache is probably in your data centers, however, CDNs are located all over the world, so that they can actually be on the edge and serve the content close to where the users are actually located. So in order to kind of best utilize these, what you probably want to do is partition your content in a way such that um you know data that is most likely to be used by certain regions is going to the particular CDN. So say if you're a news site, you know maybe you want your American news in the America CDN but then you know your Indian news in the CDN for Asia. Uh CDNs can also be either push or pull based. So of course obviously if you're pushing your data to the CDN, what it basically means is that your server is going to make a request to the CDN probably just some sort of push request that is going to periodically send data to be stored in it. So what type of use cases is this for? Well this is good when you know exactly what content users should be receiving for a certain period of time. So for example you know if you're a news site like the New York Times and once a day you're kind of uploading um that new front paper or front section. You can put the front section into that CDN via a Cron job once per day. However, there's also an option for a pull CDN. Pull CDNs are more similar to caches in the sense that, first the user is going to hit the cache and if there's a cache miss, then you're going to hit the server from the CDN to actually get the content that you want. This is really good for any type of you know social media site where certain images are going to be trending for you know a decent amount of time which you can't really predict and then people are going to kind of stop caring about them after they've all seen it. So for example, you know if a really new popular TikTok from Justin Bieber comes out or something and millions of people from the US want it, they're going to hit the America CDN and that's eventually going to be getting a ton of cache hits and then eventually everyone's going to have seen that image, they're not going to need it anymore, and then they'll start requesting for other things from that CDN and it's going to pull the new information. 
- ![[Screenshot 2024-11-11 at 9.42.51 PM.png]]
	- CDNs visualized
		- Description
			- Content delivery network
				- CDNs cache content from the origin server on geographically distributed cache servers to reach users faster
					- User
					- CDN server
					- Origin Server
		- okay, in terms of actually visualizing these CDNs um we have you know as you can see this orange origin server which is basically just the application server which is going to be located somewhere in Asia and then similarly we have all of these globally distributed CDNs which can help users all over the globe receive their content faster. I should also quickly mention just because I um kind of left it out that you know if a CDN is serving stale data, you can use something like an expiration time or sometimes even manually purge the data in order to get it out of there.
	- CDNs Analyzed
		- Description
			- Pros:
				- Greatly reduces load on server for popular content
				- Greatly increases speed to users around the world
			- Cons:
				- May occasionally serve stale data, or slow down requests on cache misses
				- Have to change static URLs in database to reflect that they are now stored by the CDN
		- Okay, so let's analyze you know the pros and cons of a CDN because I've been talking about these things and in any systems design interview, you kind of want to break down the um benefits and drawbacks of a given strategy. Um so here in general, the pros tend to greatly outweigh the cons which is why they're so popularly used but the pros are: they greatly reduce the load on your application servers for popular content and also big files. So obviously we don't want our application servers crashing because they're just being being hammered so CDNs can help reduce that. They can also protect against things like DDOS attacks by acting as some sort of reverse proxy between the client and the servers. Um I haven't really covered reverse proxies yet but basically just think of the CDN as a wall of defense between a potentially malicious client and a server. Additionally, um they greatly increase speed to users around the world. This is because they are geographically located closer to the user. That's called like um, you know storing data on the edge. The biggest cons of CDNs are that um you can occasionally serve stale data and like I said we can kind of try and mitigate that using any of the cache consistency strategies that we've discussed. You can also do it via basically just putting an expiration time on the data in there but additionally if there are cache misses, that's going to slow down any request because we're going to have to hit the CDN first before try and actually hit our server. Um the second con and this is kind of just more of an operational thing but it's something to keep in mind is that your URLs are now going to actually be located on the CDN itself so any content that's being stored in the CDN, you generally have to change the static URLs in the database to kind of represent the fact that those files are temporarily being cached in the CDN and to actually access them from there instead. I guess in theory you could you know try hitting the CDN first and then maybe it would pull data in but I'm pretty sure you have to go ahead and change those static URLs 
	- Conclusion
		- Description
			- In most large scale systems, there is a need to quickly serve static content such as HTML pages, images, and videos. While object storage systems such as AWS S3 are great for storing the original copies of these images, they are often times too slow to serve such large files to the end user.
			- Adding a content delivery network in conjunction with file storage not only takes a significant amount of load off of the application server, but it also greatly increases the speed of thees requests for static content
		- Okay, so in conclusion pretty much any single website that you're using these days that is like an actual company and not just developed by an individual person with little experience is probably using a CDN. That's because they have tons of HTML files to serve which are static. Probably tons of images and probably tons of video content as well. All of which they want to be able to be accessed quickly and also accessed in a manner that doesn't overload their servers. As a result CDNs are pretty much a guaranteed good option for any type of website at scale in terms of tackling these problems. Like I've said, caching and CDNs in general are just kind of a huge necessity for large websites in order to ensure good performance for a variety of users and as a result you should always use one if you can